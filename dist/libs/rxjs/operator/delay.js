"use strict";function delay(e,t){void 0===t&&(t=async_1.async);var i=isDate_1.isDate(e),s=i?+e-t.now():Math.abs(e);return this.lift(new DelayOperator(s,t))}var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},async_1=require("../scheduler/async"),isDate_1=require("../util/isDate"),Subscriber_1=require("../Subscriber"),Notification_1=require("../Notification");exports.delay=delay;var DelayOperator=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new DelaySubscriber(e,this.delay,this.scheduler))},e}(),DelaySubscriber=function(e){function t(t,i,s){e.call(this,t),this.delay=i,this.scheduler=s,this.queue=[],this.active=!1,this.errored=!1}return __extends(t,e),t.dispatch=function(e){for(var t=e.source,i=t.queue,s=e.scheduler,r=e.destination;i.length>0&&i[0].time-s.now()<=0;)i.shift().notification.observe(r);if(i.length>0){var o=Math.max(0,i[0].time-s.now());this.schedule(e,o)}else t.active=!1},t.prototype._schedule=function(e){this.active=!0,this.add(e.schedule(t.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},t.prototype.scheduleNotification=function(e){if(this.errored!==!0){var t=this.scheduler,i=new DelayMessage(t.now()+this.delay,e);this.queue.push(i),this.active===!1&&this._schedule(t)}},t.prototype._next=function(e){this.scheduleNotification(Notification_1.Notification.createNext(e))},t.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e)},t.prototype._complete=function(){this.scheduleNotification(Notification_1.Notification.createComplete())},t}(Subscriber_1.Subscriber),DelayMessage=function(){function e(e,t){this.time=e,this.notification=t}return e}();