"use strict";function delayWhen(e,t){return t?new SubscriptionDelayObservable(this,t).lift(new DelayWhenOperator(e)):this.lift(new DelayWhenOperator(e))}var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},Subscriber_1=require("../Subscriber"),Observable_1=require("../Observable"),OuterSubscriber_1=require("../OuterSubscriber"),subscribeToResult_1=require("../util/subscribeToResult");exports.delayWhen=delayWhen;var DelayWhenOperator=function(){function e(e){this.delayDurationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new DelayWhenSubscriber(e,this.delayDurationSelector))},e}(),DelayWhenSubscriber=function(e){function t(t,r){e.call(this,t),this.delayDurationSelector=r,this.completed=!1,this.delayNotifierSubscriptions=[],this.values=[]}return __extends(t,e),t.prototype.notifyNext=function(e,t,r,i,s){this.destination.next(e),this.removeSubscription(s),this.tryComplete()},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype.notifyComplete=function(e){var t=this.removeSubscription(e);t&&this.destination.next(t),this.tryComplete()},t.prototype._next=function(e){try{var t=this.delayDurationSelector(e);t&&this.tryDelay(t,e)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){this.completed=!0,this.tryComplete()},t.prototype.removeSubscription=function(e){e.unsubscribe();var t=this.delayNotifierSubscriptions.indexOf(e),r=null;return t!==-1&&(r=this.values[t],this.delayNotifierSubscriptions.splice(t,1),this.values.splice(t,1)),r},t.prototype.tryDelay=function(e,t){var r=subscribeToResult_1.subscribeToResult(this,e,t);this.add(r),this.delayNotifierSubscriptions.push(r),this.values.push(t)},t.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},t}(OuterSubscriber_1.OuterSubscriber),SubscriptionDelayObservable=function(e){function t(t,r){e.call(this),this.source=t,this.subscriptionDelay=r}return __extends(t,e),t.prototype._subscribe=function(e){this.subscriptionDelay.subscribe(new SubscriptionDelaySubscriber(e,this.source))},t}(Observable_1.Observable),SubscriptionDelaySubscriber=function(e){function t(t,r){e.call(this),this.parent=t,this.source=r,this.sourceSubscribed=!1}return __extends(t,e),t.prototype._next=function(e){this.subscribeToSource()},t.prototype._error=function(e){this.unsubscribe(),this.parent.error(e)},t.prototype._complete=function(){this.subscribeToSource()},t.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},t}(Subscriber_1.Subscriber);