"use strict";function expand(t,e,r){return void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===r&&(r=void 0),e=(e||0)<1?Number.POSITIVE_INFINITY:e,this.lift(new ExpandOperator(t,e,r))}var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},tryCatch_1=require("../util/tryCatch"),errorObject_1=require("../util/errorObject"),OuterSubscriber_1=require("../OuterSubscriber"),subscribeToResult_1=require("../util/subscribeToResult");exports.expand=expand;var ExpandOperator=function(){function t(t,e,r){this.project=t,this.concurrent=e,this.scheduler=r}return t.prototype.call=function(t,e){return e.subscribe(new ExpandSubscriber(t,this.project,this.concurrent,this.scheduler))},t}();exports.ExpandOperator=ExpandOperator;var ExpandSubscriber=function(t){function e(e,r,i,s){t.call(this,e),this.project=r,this.concurrent=i,this.scheduler=s,this.index=0,this.active=0,this.hasCompleted=!1,i<Number.POSITIVE_INFINITY&&(this.buffer=[])}return __extends(e,t),e.dispatch=function(t){var e=t.subscriber,r=t.result,i=t.value,s=t.index;e.subscribeToProjection(r,i,s)},e.prototype._next=function(t){var r=this.destination;if(r.closed)return void this._complete();var i=this.index++;if(this.active<this.concurrent){r.next(t);var s=tryCatch_1.tryCatch(this.project)(t,i);if(s===errorObject_1.errorObject)r.error(errorObject_1.errorObject.e);else if(this.scheduler){var o={subscriber:this,result:s,value:t,index:i};this.add(this.scheduler.schedule(e.dispatch,0,o))}else this.subscribeToProjection(s,t,i)}else this.buffer.push(t)},e.prototype.subscribeToProjection=function(t,e,r){this.active++,this.add(subscribeToResult_1.subscribeToResult(this,t,e,r))},e.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete()},e.prototype.notifyNext=function(t,e,r,i,s){this._next(e)},e.prototype.notifyComplete=function(t){var e=this.buffer;this.remove(t),this.active--,e&&e.length>0&&this._next(e.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},e}(OuterSubscriber_1.OuterSubscriber);exports.ExpandSubscriber=ExpandSubscriber;