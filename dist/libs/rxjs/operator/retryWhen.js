"use strict";function retryWhen(r){return this.lift(new RetryWhenOperator(r,this))}var __extends=this&&this.__extends||function(r,t){function e(){this.constructor=r}for(var i in t)t.hasOwnProperty(i)&&(r[i]=t[i]);r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)},Subject_1=require("../Subject"),tryCatch_1=require("../util/tryCatch"),errorObject_1=require("../util/errorObject"),OuterSubscriber_1=require("../OuterSubscriber"),subscribeToResult_1=require("../util/subscribeToResult");exports.retryWhen=retryWhen;var RetryWhenOperator=function(){function r(r,t){this.notifier=r,this.source=t}return r.prototype.call=function(r,t){return t.subscribe(new RetryWhenSubscriber(r,this.notifier,this.source))},r}(),RetryWhenSubscriber=function(r){function t(t,e,i){r.call(this,t),this.notifier=e,this.source=i}return __extends(t,r),t.prototype.error=function(t){if(!this.isStopped){var e=this.errors,i=this.retries,s=this.retriesSubscription;if(i)this.errors=null,this.retriesSubscription=null;else{if(e=new Subject_1.Subject,i=tryCatch_1.tryCatch(this.notifier)(e),i===errorObject_1.errorObject)return r.prototype.error.call(this,errorObject_1.errorObject.e);s=subscribeToResult_1.subscribeToResult(this,i)}this.unsubscribe(),this.closed=!1,this.errors=e,this.retries=i,this.retriesSubscription=s,e.next(t)}},t.prototype._unsubscribe=function(){var r=this,t=r.errors,e=r.retriesSubscription;t&&(t.unsubscribe(),this.errors=null),e&&(e.unsubscribe(),this.retriesSubscription=null),this.retries=null},t.prototype.notifyNext=function(r,t,e,i,s){var u=this,o=u.errors,n=u.retries,c=u.retriesSubscription;this.errors=null,this.retries=null,this.retriesSubscription=null,this.unsubscribe(),this.isStopped=!1,this.closed=!1,this.errors=o,this.retries=n,this.retriesSubscription=c,this.source.subscribe(this)},t}(OuterSubscriber_1.OuterSubscriber);