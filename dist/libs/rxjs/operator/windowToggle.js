"use strict";function windowToggle(t,e){return this.lift(new WindowToggleOperator(t,e))}var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},Subject_1=require("../Subject"),Subscription_1=require("../Subscription"),tryCatch_1=require("../util/tryCatch"),errorObject_1=require("../util/errorObject"),OuterSubscriber_1=require("../OuterSubscriber"),subscribeToResult_1=require("../util/subscribeToResult");exports.windowToggle=windowToggle;var WindowToggleOperator=function(){function t(t,e){this.openings=t,this.closingSelector=e}return t.prototype.call=function(t,e){return e.subscribe(new WindowToggleSubscriber(t,this.openings,this.closingSelector))},t}(),WindowToggleSubscriber=function(t){function e(e,r,o){t.call(this,e),this.openings=r,this.closingSelector=o,this.contexts=[],this.add(this.openSubscription=subscribeToResult_1.subscribeToResult(this,r,r))}return __extends(e,t),e.prototype._next=function(t){var e=this.contexts;if(e)for(var r=e.length,o=0;o<r;o++)e[o].window.next(t)},e.prototype._error=function(e){var r=this.contexts;if(this.contexts=null,r)for(var o=r.length,i=-1;++i<o;){var s=r[i];s.window.error(e),s.subscription.unsubscribe()}t.prototype._error.call(this,e)},e.prototype._complete=function(){var e=this.contexts;if(this.contexts=null,e)for(var r=e.length,o=-1;++o<r;){var i=e[o];i.window.complete(),i.subscription.unsubscribe()}t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.contexts;if(this.contexts=null,t)for(var e=t.length,r=-1;++r<e;){var o=t[r];o.window.unsubscribe(),o.subscription.unsubscribe()}},e.prototype.notifyNext=function(t,e,r,o,i){if(t===this.openings){var s=this.closingSelector,n=tryCatch_1.tryCatch(s)(e);if(n===errorObject_1.errorObject)return this.error(errorObject_1.errorObject.e);var c=new Subject_1.Subject,u=new Subscription_1.Subscription,b={window:c,subscription:u};this.contexts.push(b);var l=subscribeToResult_1.subscribeToResult(this,n,b);l.closed?this.closeWindow(this.contexts.length-1):(l.context=b,u.add(l)),this.destination.next(c)}else this.closeWindow(this.contexts.indexOf(t))},e.prototype.notifyError=function(t){this.error(t)},e.prototype.notifyComplete=function(t){t!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(t.context))},e.prototype.closeWindow=function(t){if(t!==-1){var e=this.contexts,r=e[t],o=r.window,i=r.subscription;e.splice(t,1),o.complete(),i.unsubscribe()}},e}(OuterSubscriber_1.OuterSubscriber);