"use strict";function windowWhen(t){return this.lift(new WindowOperator(t))}var __extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var o in i)i.hasOwnProperty(o)&&(t[o]=i[o]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},Subject_1=require("../Subject"),tryCatch_1=require("../util/tryCatch"),errorObject_1=require("../util/errorObject"),OuterSubscriber_1=require("../OuterSubscriber"),subscribeToResult_1=require("../util/subscribeToResult");exports.windowWhen=windowWhen;var WindowOperator=function(){function t(t){this.closingSelector=t}return t.prototype.call=function(t,i){return i.subscribe(new WindowSubscriber(t,this.closingSelector))},t}(),WindowSubscriber=function(t){function i(i,e){t.call(this,i),this.destination=i,this.closingSelector=e,this.openWindow()}return __extends(i,t),i.prototype.notifyNext=function(t,i,e,o,r){this.openWindow(r)},i.prototype.notifyError=function(t,i){this._error(t)},i.prototype.notifyComplete=function(t){this.openWindow(t)},i.prototype._next=function(t){this.window.next(t)},i.prototype._error=function(t){this.window.error(t),this.destination.error(t),this.unsubscribeClosingNotification()},i.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},i.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},i.prototype.openWindow=function(t){void 0===t&&(t=null),t&&(this.remove(t),t.unsubscribe());var i=this.window;i&&i.complete();var e=this.window=new Subject_1.Subject;this.destination.next(e);var o=tryCatch_1.tryCatch(this.closingSelector)();if(o===errorObject_1.errorObject){var r=errorObject_1.errorObject.e;this.destination.error(r),this.window.error(r)}else this.add(this.closingNotification=subscribeToResult_1.subscribeToResult(this,o))},i}(OuterSubscriber_1.OuterSubscriber);